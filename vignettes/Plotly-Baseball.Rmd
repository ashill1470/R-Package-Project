---
title: "Plotly-Baseball"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Plotly-Baseball}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(RPackProj)
library(plotly)
library(tidyverse)
library(dplyr)
```

## Plotly Basics

Plotly is an R package that creates high quality, interactive plots and graphs. 

To get started, just call the plotting function `plot_ly()`. The most basic plot you can make in plotly is a scatterplot:

```{r message=FALSE, warning=FALSE}
tigers <- baseball |>
  filter(teamID %in% c('DET'))
plot_ly(data=tigers, x=~yearID, y=~W, type = 'scatter')
```

By including `marker()`, you can do other customization, like changing the point color.

```{r message=FALSE, warning=FALSE}
plot_ly(data=tigers, x=~yearID, y=~W, type = 'scatter', 
        marker = list(size = 7.5,
               color = 'orange')
        )
```

Use the pipe operator and you can include proper labeling. 

```{r message=FALSE, warning=FALSE}
plot_ly(data=tigers, x=~yearID, y=~W, type='scatter', 
        marker = list(size = 7.5,
               color = 'orange')
        ) |>
  layout(
    title = 'Detroit Wins since 1901',
    xaxis = list(title = 'Year'),
    yaxis = list(title = 'Wins')
  )
```

What if we wanted to 'connect the dots'? Just add `mode = 'lines'`

```{r}
plot_ly(data=tigers, x=~yearID, y=~W, type='scatter', mode = 'lines') |>
  layout(
    title = 'Detroit Wins since 1901',
    xaxis = list(title = 'Year'),
    yaxis = list(title = 'Wins')
  ) 
```

What if you want to have scatterplots of multiple teams?

```{r}
tigers_and_cubs <- baseball |>
  filter(yearID >= 1901) |>
  filter(franchID %in% c('DET', 'CHC')) 
plot_ly(data=tigers_and_cubs, x=~yearID, y=~W, type = 'scatter', color=~teamID)
```








### Animations 

```{r}
accumulate_by <- function(dat, var) {
  var <- lazyeval::f_eval(var, dat)
  lvls <- plotly:::getLevels(var)
  dats <- lapply(seq_along(lvls), function(x) {
    cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]])
  })
  dplyr::bind_rows(dats)
}


df <- baseball %>% 
  filter(teamID %in% c('DET', 'CHA'))
fig <- df 
fig <- fig %>% accumulate_by(~yearID)

fig <- fig %>%
  plot_ly(
    x = ~yearID, 
    y = ~winPercentage,
    split = ~teamID,
    frame = ~frame, 
    type = 'scatter',
    mode = 'lines', 
    line = list(simplyfy = F)
  )

fig <- fig %>% layout(
  xaxis = list(
    title = "Year",
    zeroline = F
  ),
  yaxis = list(
    title = "Winning Percentage",
    zeroline = F
  )
) 

fig <- fig %>% animation_opts(
  frame = 500, 
  transition = 0, 
  redraw = FALSE
)

fig <- fig %>% animation_slider(
  hide = F
)

fig <- fig %>% animation_button(
  x = 1, xanchor = "right", y = 0, yanchor = "bottom"
)


fig
```




